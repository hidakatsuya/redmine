<% @gantt.view = self %>
<% issue_relation_types = Redmine::Helpers::Gantt::DRAW_TYPES %>
<% unavailable_columns = Redmine::Helpers::Gantt::UNAVAILABLE_COLUMNS.map(&:to_s) %>

<div class="gantt-page"
     data-controller="gantt"
     data-gantt-issue-relation-types-value="<%= html_escape(issue_relation_types.to_json) %>"
     data-gantt-unavailable-columns-value="<%= html_escape(unavailable_columns.to_json) %>">
  <div class="contextual">
  </div>

  <h2><%= @query.new_record? ? l(:label_gantt) : @query.name %></h2>
  <%= @query.persisted? && @query.description.present? ? content_tag('p', @query.description, class: 'subtitle') : '' %>

  <%= render partial: 'query_form', locals: {project: @project, query: @query, gantt: @gantt} %>

  <%= error_messages_for 'query' %>
  <% if @query.valid? %>
    <%= render partial: 'chart', locals: {gantt: @gantt, query: @query} %>
  <% end %>
</div>

<% content_for :sidebar do %>
  <%= render partial: 'issues/sidebar' %>
<% end %>

<% html_title(l(:label_gantt)) -%>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 'gantt' %>
  <%= javascript_include_tag 'raphael' %>
<% end %>

<%= context_menu %>
